{% extends 'base.html' %}

{% block content %}

<div class="container">
  <h2>All Users Map</h2>
  <hr>
  {% if user_data %}
    <div id="map" style="height: 500px;"></div>
    <ul>
      {% for user in user_data %}
        <li>{{ user.name }} ({{ user.lat }}, {{ user.lng }})</li>
      {% endfor %}
    </ul>
  {% else %}
    <p>No user locations found.</p>
  {% endif %}
</div>

{% endblock %}

{% block scripts %}

<!-- jQuery CDN -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- Custom Script -->
{% if user_data %}
<script type="text/javascript">
  $(document).ready(function() {
    // Create Leaflet instance
    var map = L.map('map').setView([0, 0], 1.5);

    // Add OpenStreetMap layer
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Map data Â© <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors',
      maxZoom: 18,
    }).addTo(map);

    // Add markers for each user
    var markers = [];
    {% for user in user_data %}
      var marker = L.marker([{{ user.lat }}, {{ user.lng }}])
        .bindPopup('<h5><a href="{{ user.url }}">{{ user.name }}</a></h5>')
        .addTo(map);
      markers.push(marker);
    {% endfor %}

    // Fit map to markers
    var group = new L.featureGroup(markers);
    map.fitBounds(group.getBounds(), { padding: [70, 70] });

    // Resize map on window resize
    window.onresize = function() {
      map.invalidateSize();
    }
  });
</script>
{% endif %}
{% endblock %}
